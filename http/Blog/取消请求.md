## [AbortController](https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController)

AbortController æŽ¥å£è¡¨ç¤ºä¸€ä¸ªæŽ§åˆ¶å™¨å¯¹è±¡ï¼Œå…è®¸ä½ æ ¹æ®éœ€è¦ä¸­æ­¢**ä¸€ä¸ª**æˆ–**å¤šä¸ª** Web è¯·æ±‚ã€‚

> [å…¼å®¹æ€§](https://caniuse.com/?search=AbortController) ï¼šPC ç«¯åªæœ‰ `IE` ä¸æ”¯æŒï¼›ç§»åŠ¨ç«¯ `Opera Mini` æ‰€æœ‰ç‰ˆæœ¬éƒ½ä¸æ”¯æŒ, `UC Browser for Android` > 12.12, `QQ Browser` > 10.4 ...

## ç®€å•å°è£…ä¸€ä¸ªç”Ÿæˆä¸­æ–­æŽ§åˆ¶å™¨çš„æ–¹æ³•

```js
function setAbortController() {
  var controller = new AbortController();
  var signal = controller.signal;
  var cancel = function () {
    controller.abort();
  };

  return { signal, cancel };
}
```

## [Fetch API å®žçŽ°](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API)

ðŸŒ¡ **æ³¨æ„ï¼š**å½“ `abort()` è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ª `fetch()` promise å°† `reject` ä¸€ä¸ªåä¸º `AbortError` çš„ [DOMException](https://developer.mozilla.org/zh-CN/docs/Web/API/DOMException)ã€‚

```js
// define å®šä¹‰
function query(options) {
  const { signal, abort } = setAbortController();

  const request = fetch(url, {
    signal,
    method: "POST",
    body: JSON.stringify(options),
    headers: { "Content-Type": "application/json;charset=UTF-8" },
  }).then((res) => {
    if (res.status === 200) return res.json();
    throw new Error();
  });

  return { request, abort };
}

// å‘èµ·è¯·æ±‚å¹¶ç¼“å­˜abort
const { request, abort } = query(params);
this.abortRequest = abort; // ç¼“å­˜ abort æ–¹æ³•
request
  .then((data) => {
    console.log("data:", data);
    this.abortRequest = null;
  })
  .catch((error) => {
    if (error.code === 20) {
      // è¡¨ç¤ºå·²è¢«ä¸­æ–­
      console.log("error code:", error.code);
      console.log("error message:", error.message);
      console.log("error name:", error.name);
    }
  });

// callback è°ƒç”¨
if (this.abortRequest instanceof Function) {
  this.abortRequest();
  this.abortRequest = null;
}
```

ðŸ¤” **Questionsï¼š**ä¸Šè¿°å†…å®¹ä½¿ç”¨çš„æ˜¯ [Fetch API](https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API)ï¼Œé‚£ [XMLHttpRequest](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest) å¦‚ä½•å®žçŽ°?

## [XMLHttpRequest å®žçŽ°](https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest)
